(()=>{"use strict";var e={78:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),r=n.n(o),s=n(314),a=n.n(s)()(r());a.push([e.id,"@media screen and (max-width: 520px) {\n  .header {\n    flex-direction: column;\n    gap: 10px;\n    padding: 5px;\n  }\n  .header button {\n    display: inline-block;\n    margin: 5px;\n  }\n  .chat-wrapper {\n    flex-direction: column;\n  }\n  .left-section {\n    width: 100%;\n    align-items: center;\n  }\n  input[type='search'] {\n    width: 40%;\n  }\n  .messages-section {\n    width: 100%;\n  }\n  .footer {\n    flex-direction: column;\n    align-items: center;\n  }\n}\n",""]);const i=a},149:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),r=n.n(o),s=n(314),a=n.n(s)()(r());a.push([e.id,".login-form {\n  max-width: 350px;\n  margin: 100px auto 0 auto;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 20px;\n}\n\n.btn-submit,\n.btn-info {\n  background-color: var(--blue-dark-color);\n  color: var(--light-color);\n  margin: 10px auto;\n}\n\n.btn-submit:hover,\n.btn-info:hover {\n  background-color: var(--blue-light-color);\n  transition: 1s;\n  border-radius: 5px;\n}\n\n.login-form input[type='text'],\ninput[type='password'] {\n  width: 100%;\n  height: 40px;\n  padding: 5px;\n}\n",""]);const i=a},303:(e,t,n)=>{n.d(t,{A:()=>m});var o=n(601),r=n.n(o),s=n(314),a=n.n(s),i=n(417),c=n.n(i),l=new URL(n(868),n.b),d=new URL(n(194),n.b),u=a()(r()),p=c()(l),g=c()(d);u.push([e.id,`.wrapper {\n  max-width: 900px;\n  box-shadow: 0 2px 4px var(--light-grey-color);\n  border-radius: 5px;\n  margin: 20px auto;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\nheader {\n  background-color: var(--blue-dark-color);\n  color: var(--light-color);\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  padding: 10px;\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\nh1 {\n  margin: 0;\n}\nh2 {\n  margin: 0;\n  justify-self: flex-start;\n}\n\n.chat-wrapper {\n  display: flex;\n  flex-direction: row;\n  border: 1px solid var(--grey-dark-color);\n  background-color: var(--light-color);\n}\n.left-section {\n  width: 30%;\n  padding: 20px;\n  overflow-y: auto;\n  box-shadow: 1px 2px 2px var(--grey-dark-color);\n}\n.users-section {\n  display: flex;\n  flex-direction: column;\n}\n\n.user-active {\n  color: var(--online-color);\n}\n\n.user-inactive {\n  color: var(--offline-color);\n}\n\n.users-section div {\n  cursor: pointer;\n  list-style-type: none;\n  font-size: 18px;\n  padding: 5px;\n}\n.users-section div:hover {\n  background-color: var(--main-color);\n}\n.users-section div i {\n  margin-right: 10px;\n}\n\n.messages-section {\n  width: 70%;\n  padding: 10px;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  background: url(${p});\n  background-size: 400px;\n}\n\n.user-dialog-info {\n  padding: 0px 20px 20px 20px;\n  height: 60px;\n  border-bottom: 1px solid var(--dark-color);\n  display: flex;\n  justify-content: space-between;\n  font-size: 18px;\n}\n.dialog-wrapper {\n  height: 350px;\n  display: flex;\n  flex-direction: column;\n  justify-content: end;\n}\n.dialog {\n  display: block;\n  overflow-y: auto;\n  /* scroll-behavior: smooth;*/\n}\n.dialog-intro {\n  margin-left: 25%;\n  margin-bottom: 30%;\n}\n.message-dialog {\n  border: 1px solid var(--light-grey-color);\n  width: 60%;\n  border-radius: 5px;\n  margin: 10px;\n  padding: 5px;\n  background-color: var(--light-color);\n  position: relative;\n}\n\n.wrapper-info-messages {\n  display: flex;\n  justify-content: space-between;\n  background-color: var(--main-color);\n  border-radius: 3px;\n}\n.message-dialog div:nth-child(2) {\n  margin: 5px;\n}\n.message-info {\n  font-size: 12px;\n  padding: 2px;\n}\n\n.sender-message {\n  margin-left: 38%;\n  border-radius: 10px 10px 10px 0px;\n}\n\n.receiver-message {\n  margin-right: 38%;\n  border-radius: 10px 10px 0px 10px;\n}\n.context-menu {\n  margin: 10px;\n  background-color: var(--light-color);\n  border: 1px solid var(--light-grey-color);\n  border-radius: 5px;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n.context-menu div {\n  margin: 5px;\n  padding: 5px;\n  cursor: pointer;\n}\n.context-menu div:hover {\n  background-color: var(--main-color);\n}\n\n.form-new-message {\n  padding-top: 10px;\n  border-top: 1px solid var(--dark-color);\n  display: flex;\n  justify-content: space-around;\n  align-content: center;\n}\n.btn-send-message {\n  background-color: var(--blue-dark-color);\n  color: var(--light-color);\n}\n\n.btn-send-message:hover {\n  background-color: var(--blue-light-color);\n  transition: 1s;\n  border-radius: 5px;\n  transform: scale(0.98);\n}\n.header .btn-info,\n.btn-logout {\n  background-color: var(--light-color);\n  color: var(--dark-color);\n}\n.header .btn-info:hover,\n.btn-logout:hover {\n  color: var(--dark-color);\n  transition: 1s;\n  border-radius: 7px;\n  transform: scale(0.98);\n}\n\n.form-new-message input[type='text'] {\n  width: 70%;\n  height: 40px;\n  padding: 5px;\n  border: 1px solid var(--light-grey-color);\n}\n\nfooter {\n  background-color: var(--blue-dark-color);\n  color: var(--light-color);\n  display: flex;\n  justify-content: space-around;\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\nfooter a {\n  color: var(--light-color);\n  text-decoration: none;\n}\n.link-school {\n  position: relative;\n}\n.link-school:after {\n  position: absolute;\n  content: '';\n  display: inline-block;\n  background: url(${g}) no-repeat #fff;\n  border: 2px solid #fff;\n  width: 40px;\n  height: 15px;\n  margin-left: 10px;\n  padding: 4px;\n  bottom: 0;\n}\n\n.disabled {\n  pointer-events: none;\n  background-color: var(--main-color);\n  color: var(--dark-grey-color);\n}\n.hidden {\n  display: none;\n}\n\ninput[type='search'] {\n  background-color: var(--light-color);\n  width: 80%;\n  margin-top: 20px;\n  margin-bottom: 20px;\n  padding: 5px;\n  border-radius: 5px;\n  border: 1px solid var(--dark-color);\n}\n`,""]);const m=u},208:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),r=n.n(o),s=n(314),a=n.n(s)()(r());a.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap);"]),a.push([e.id,":root {\n  --main-color: #e9e9e9;\n  --blue-dark-color: #057182;\n  --blue-light-color: #06879b;\n  --light-color: #f5f5f5;\n  --dark-color: #2f2f2f;\n  --light-grey-color: #9f9f9f;\n  --offline-color: #8d0212;\n  --online-color: #029b54;\n}\n\n* {\n  box-sizing: border-box;\n}\n\nbody {\n  background-color: var(--main-color);\n  margin: 20px;\n  font:\n    16px Inter,\n    sans-serif;\n  color: var(--text-color);\n}\n\n.modal {\n  background-color: var(--blue-light-color);\n  border-radius: 5px;\n  color: var(--light-color);\n  padding: 40px;\n  text-align: center;\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  max-width: 500px;\n  min-width: 200px;\n  min-height: 100px;\n  z-index: 15;\n}\n.modal-bg {\n  content: '';\n  position: fixed;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 5;\n}\n.close-modal {\n  cursor: pointer;\n  position: absolute;\n  top: 0px;\n  right: 10px;\n  font-size: 24px;\n}\n\nbutton,\ninput[type='submit'] {\n  width: 100px;\n  height: 40px;\n  padding: 5px;\n  width: 150px;\n  border: none;\n  cursor: pointer;\n  display: block;\n  border-radius: 3px;\n}\n",""]);const i=a},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,r,s){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var i=0;i<this.length;i++){var c=this[i][0];null!=c&&(a[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);o&&a[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),t.push(d))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var s={},a=[],i=0;i<e.length;i++){var c=e[i],l=o.base?c[0]+o.base:c[0],d=s[l]||0,u="".concat(l," ").concat(d);s[l]=d+1;var p=n(u),g={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)t[p].references++,t[p].updater(g);else{var m=r(g,o);o.byIndex=i,t.splice(i,0,{identifier:u,updater:m,references:1})}a.push(u)}return a}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var s=o(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<s.length;a++){var i=n(s[a]);t[i].references--}for(var c=o(e,r),l=0;l<s.length;l++){var d=n(s[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}s=c}}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},868:(e,t,n)=>{e.exports=n.p+"2a8bb617f7aa7a0977f5.jpg"},194:(e,t,n)=>{e.exports=n.p+"ad178c0df28bc133be34.svg"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={id:o,exports:{}};return e[o](s,s.exports,n),s.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=o[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.b=document.baseURI||self.location.href,n.nc=void 0,(()=>{function e(e,t,n,o){const r=document.createElement("a");return r.className=`${o}`,r.textContent=`${n}`,r.href=`${t}`,e.append(r),r.setAttribute("target","_blank"),r}function t(e,t,n,o){const r=document.createElement(`${e}`);return o&&(r.className=`${o}`),n&&(r.textContent=`${n}`),t&&t.append(r),r}function o(e,t,n,o,r){const s=document.createElement("input");return s.type=t,s.placeholder=n,e.append(s),r&&(s.className=`${r}`),o&&(s.name=o),s}class r{getResultTag(){return this.tagResult}constructor(e){this.tagResult=t("div",document.body,"","modal-bg");const n=t("div",this.tagResult,e,"modal"),o=t("span",n,"","close-modal");o.innerHTML="&times;",o.addEventListener("click",(()=>{this.tagResult.remove()}))}}function s(){const e=document.querySelector(".login-form");e.onsubmit=t=>{t.preventDefault();const n=new FormData(e),o=n.get("login"),r=n.get("password");sessionStorage.setItem("login-fun-chat",o),sessionStorage.setItem("password",r),U(o,r)}}function a(){const e=document.querySelector(".form-new-message");e.onsubmit=t=>{t.preventDefault(),function(e){const t=document.querySelector(".receiver").textContent;document.querySelector(".text-message").value="",document.querySelector(".dialog-intro")?.remove();const n={id:String((new Date).getTime()),type:"MSG_SEND",payload:{message:{to:t,text:e}}};e&&O.send(JSON.stringify(n))}(new FormData(e).get("text"))}}var i=n(72),c=n.n(i),l=n(825),d=n.n(l),u=n(659),p=n.n(u),g=n(56),m=n.n(g),f=n(540),h=n.n(f),v=n(113),x=n.n(v),b=n(149),y={};y.styleTagTransform=x(),y.setAttributes=m(),y.insert=p().bind(null,"head"),y.domAPI=d(),y.insertStyleElement=h(),c()(b.A,y),b.A&&b.A.locals&&b.A.locals;class S{getResultTag(){return this.tagResult}constructor(){this.tagResult=t("form",document.body,"","login-form");const e=o(this.tagResult,"text","Логин","login","login"),n=o(this.tagResult,"password","Пароль","password","password"),r=o(this.tagResult,"submit","","","btn-submit");e.required=!0,r.value="Войти",e.pattern="^[a-zA-z]{3,10}",e.title="Логин должен быть не короче 3 символов и не длиннее 10 символов и содержать буквы латинского алфавита",n.pattern="(?=.*[A-Z])(?=.*[0-9]).{4,10}",n.title="Пароль должен быть не короче 4 символов и не длиннее 10 символов и содержать минимум одну большую букву латинского алфавита и одну цифру",e.setAttribute("oninput","this.setCustomValidity('')"),n.setAttribute("oninput","this.setCustomValidity('')")}}class w{getResultTag(){return this.tagResult}constructor(){this.tagResult=document.createElement("footer"),this.tagResult.className="footer";const n=t("p",this.tagResult);e(n,"https://rs.school/","RSSchool","link-school");const o=t("p",this.tagResult);e(o,"https://github.com/ifbfirst","Kate Mashko GitHub");const r=t("p",this.tagResult,"2024");this.tagResult.append(n,o,r)}}class R{getResultTag(){return this.tagResult}constructor(e){this.tagResult=t("header"),this.tagResult.className="header",t("h2",this.tagResult,`Пользователь: ${e}`),t("h1",this.tagResult,"Fun chat");const n=t("div",this.tagResult),o=t("button",n,"Выход","btn-logout"),r=t("button",n,"Информация","btn-info");o.onclick=()=>function(){const e=sessionStorage.getItem("login-fun-chat"),t={id:e,type:"USER_LOGOUT",payload:{user:{login:e,password:sessionStorage.getItem("password")}}};O.send(JSON.stringify(t))}(),r.onclick=()=>I()}}var k=n(303),E={};E.styleTagTransform=x(),E.setAttributes=m(),E.insert=p().bind(null,"head"),E.domAPI=d(),E.insertStyleElement=h(),c()(k.A,E),k.A&&k.A.locals&&k.A.locals;var A=n(78),T={};T.styleTagTransform=x(),T.setAttributes=m(),T.insert=p().bind(null,"head"),T.domAPI=d(),T.insertStyleElement=h(),c()(A.A,T),A.A&&A.A.locals&&A.A.locals;class q{getResultTag(){return this.tagResult}constructor(e){this.tagResult=t("div",document.body,"","wrapper");const n=t("div",this.tagResult,"","chat-wrapper");this.tagResult.append(new R(e).getResultTag(),n,(new w).getResultTag()),this.createUserSection(n),this.createMessagesSection(n)}createUserSection(e){const n=t("section",e,"","left-section"),r=o(n,"search","поиск...","search"),s=t("section",n,"","users-section");r.autocomplete="off",r.onchange=()=>{$()},r.onkeydown=()=>{$()},s.onclick=e=>{!function(e){const t=e.target,n=t.textContent,o=document.querySelector(".receiver");document.querySelector(".text-message")?.classList.remove("disabled"),document.querySelector(".btn-send-message")?.classList.remove("disabled"),t.closest("div")&&o&&n&&(o.textContent=`${n}`,t.classList.contains("user-active")&&C("в сети","user-inactive","user-active"),t.classList.contains("user-inactive")&&C("не в сети","user-active","user-inactive"),a(),function(e){const t={id:String((new Date).getTime()),type:"MSG_FROM_USER",payload:{user:{login:e}}};O.send(JSON.stringify(t))}(n))}(e)}}createMessagesSection(e){const n=t("section",e,"","messages-section"),r=t("div",n,"","user-dialog-info");t("p",r,"","receiver"),t("p",r,"","receiver-status");const s=t("div",n,"","dialog-wrapper"),a=t("div",s,"","dialog");t("p",a,"Выберите пользователя и начните диалог","dialog-intro");const i=t("form",n,"","form-new-message");o(i,"text","Сообщение...","text","text-message disabled"),o(i,"submit","","","btn-send-message disabled")}}function I(){new r("Приложение Fun chat разработано в рамках курса JavaScript/Front-end 2023Q4. Aвтор Kate Mashko.")}function C(e,t,n){const o=document.querySelector(".receiver-status");o&&(o.textContent=`${e}`,o.classList.remove(`${t}`),o.classList.add(`${n}`))}function L(){const e=document.querySelector(".dialog-wrapper"),t=document.querySelector(".dialog"),n=document.querySelectorAll(".receiver-message"),o=document.querySelector(".btn-send-message");e.onclick=()=>{n.forEach((e=>{j(e.id)}))},setTimeout((function(){t.addEventListener("scroll",(function(){n.forEach((e=>{j(e.id)}))}))}),500),o.onclick=()=>{n.forEach((e=>{j(e.id)}))}}function $(){const e=document.querySelector(".search"),t=document.querySelectorAll(".user"),n=e.value;t.forEach((e=>{e.textContent?.includes(n)||e.classList.add("hidden")})),e.addEventListener("input",(e=>{e.target.value||t.forEach((e=>{e.classList.remove("hidden")}))}))}function M(e,t,n){const o=document.querySelectorAll(`.${n}`),r=document.querySelector(".users-section"),s=document.querySelector(".receiver-status"),a=e.payload.user.login;o.forEach((e=>{e.textContent===a&&(e.classList.remove(`${n}`),e.classList.add(`${t}`),"user-active"===t&&(r?.prepend(e),0!==s?.textContent?.length&&C("в сети","user-inactive","user-active")),"user-inactive"===t&&(r?.append(e),0!==s?.textContent?.length&&C("не в сети","user-active","user-inactive")))}))}function N(e){return!0===e.isReaded?"прочитано":!0===e.isDelivered?"доставлено":!1===e.isDelivered?"отправлено":void 0}class _{getResultTag(){return this.tagResult}constructor(e,n,o,r,s,i,c){this.tagResult=document.createElement("div"),this.tagResult.className=n,this.tagResult.id=i,this.text=e,this.user=o,this.status=s,this.edit=c,this.time=function(e){return`${new Date(e).toTimeString().split(" ")[0]}`}(r),document.querySelector(".dialog")?.append(this.tagResult);const l=t("div",this.tagResult,"","wrapper-info-messages");t("span",l,this.user,"message-info"),t("span",l,`${this.time}`,"message-info"),t("div",this.tagResult,this.text,"message");const d=t("div",this.tagResult,"","wrapper-info-messages");t("span",d,this.status,"message-info status"),n.includes("sender-message")&&(this.tagResult.oncontextmenu=e=>function(e,n){e.preventDefault(),document.querySelector(".context-menu")?.remove();const o=t("div",n,"","context-menu"),r=t("div",o,"Изменить"),s=t("div",o,"Удалить");r.onclick=()=>function(e){const t=document.querySelector(".text-message");let n=e.querySelector(".message"),o=n?.textContent;t&&(t.value=`${o}`);const r=document.querySelector(".form-new-message");r.onsubmit=o=>{o.preventDefault();const s=new FormData(r).get("text");0!==s.length&&(function(e,t){const n={id:String((new Date).getTime()),type:"MSG_EDIT",payload:{message:{id:e,text:t}}};O.send(JSON.stringify(n))}(e.id,s),t.value="",n&&(n.textContent=s)),a()}}(n),s.onclick=()=>function(e){const t={id:String((new Date).getTime()),type:"MSG_DELETE",payload:{message:{id:e}}};O.send(JSON.stringify(t))}(n.id),window.onclick=()=>document.querySelector(".context-menu")?.remove()}(e,this.tagResult)),!0===this.edit?t("span",d,"изменено","message-info edit"):t("span",d,"","message-info edit"),this.tagResult.scrollIntoView()}}function D(e,n){const o=document.querySelector(".users-section"),r=sessionStorage.getItem("login-fun-chat");e.payload.users.forEach((e=>{r&&e.login!==r&&(t("div",o,"",`${n} user`).innerHTML=`<i class="fa-regular fa-face-smile"></i>${e.login}`)}))}let O=new WebSocket("ws://127.0.0.1:4000");function U(e,t){const n={id:e,type:"USER_LOGIN",payload:{user:{login:e,password:t}}};O.send(JSON.stringify(n))}function G(e){const t={id:`user-${e}`,type:`USER_${e.toUpperCase()}`,payload:null};O.send(JSON.stringify(t))}function j(e){const t={id:String((new Date).getTime()),type:"MSG_READ",payload:{message:{id:e}}};O.send(JSON.stringify(t))}O.onmessage=e=>{const n=e.data,o=JSON.parse(n);switch(o.type){case"ERROR":!function(e){"a user with this login is already authorized"===e.payload.error&&new r("Пользователь с таким логином уже авторизован"),"incorrect password"===e.payload.error&&new r("Пароль не верен")}(o);break;case"USER_LOGIN":!function(e){const t=e.payload.user.login;document.querySelector("form")?.remove(),document.querySelector(".btn-info")?.remove(),new q(t),G("active"),G("inactive")}(o);break;case"USER_LOGOUT":document.querySelector(".wrapper")?.remove(),new S,t("button",document.body,"Информация","btn-info").onclick=()=>I(),s();break;case"USER_ACTIVE":D(o,"user-active");break;case"USER_INACTIVE":D(o,"user-inactive");break;case"USER_EXTERNAL_LOGOUT":M(o,"user-inactive","user-active");break;case"USER_EXTERNAL_LOGIN":!1===function(e){const t=e.payload.user.login,n=document.querySelectorAll(".user");let o=[];if(n.forEach((e=>{e.textContent===t&&o.push(e)})),0===o.length)return!1}(o)?function(e){const n=e.payload.user.login;t("div",document.querySelector(".users-section"),"","user-active user").innerHTML=`<i class="fa-regular fa-face-smile"></i>${n}`}(o):M(o,"user-active","user-inactive");break;case"MSG_FROM_USER":!function(e){const n=document.querySelector(".dialog"),o=sessionStorage.getItem("login-fun-chat"),r=document.querySelector(".receiver")?.textContent;let s;n&&(n.textContent=""),0!==e.payload.messages.length?(e.payload.messages.forEach((e=>{s=N(e.status),e.from===r&&new _(e.text,"message-dialog receiver-message",e.from,e.datetime," ",e.id,e.status.isEdited),e.from===o&&new _(e.text,"message-dialog sender-message","вы",e.datetime,s,e.id,e.status.isEdited)})),L()):t("p",n,"Напишите первое сообщение...","dialog-intro")}(o);break;case"MSG_SEND":!function(e){const t=document.querySelector(".receiver")?.textContent,n=sessionStorage.getItem("login-fun-chat");e.from===n&&new _(e.text,"message-dialog sender-message","вы",e.datetime,N(e.status),e.id,e.status.isEdited),e.from===t&&(new _(e.text,"message-dialog receiver-message",t,e.datetime," ",e.id,e.status.isEdited),document.querySelector(".dialog-intro")?.remove()),L()}(o.payload.message);break;case"MSG_DELIVER":a=o.payload.message.id,document.querySelectorAll(".sender-message").forEach((e=>{if(a===e.id){const t=e.querySelector(".status");t&&(t.textContent="доставлено")}}));break;case"MSG_READ":!function(e){const t=document.getElementById(`${e}`);if(t?.className.includes("sender-message")){const e=t?.querySelector(".status");e&&(e.textContent="прочитано")}}(o.payload.message.id);break;case"MSG_DELETE":!function(e){document.getElementById(`${e}`)?.remove()}(o.payload.message.id);break;case"MSG_EDIT":!function(e,t){const n=document.getElementById(`${e}`),o=n?.querySelector(".message");o&&(o.textContent=t);const r=n?.querySelector(".edit");r&&(r.textContent="изменено")}(o.payload.message.id,o.payload.message.text)}var a},O.onclose=function(e){e.wasClean||new r("Ошибка на сервере. Запускаем заново...")};var z=n(208),F={};F.styleTagTransform=x(),F.setAttributes=m(),F.insert=p().bind(null,"head"),F.domAPI=d(),F.insertStyleElement=h(),c()(z.A,F),z.A&&z.A.locals&&z.A.locals,(new class{start(){O.onopen=function(){},sessionStorage.getItem("login-fun-chat")?setTimeout((()=>U(sessionStorage.getItem("login-fun-chat"),sessionStorage.getItem("password"))),100):(new S,t("button",document.body,"Информация","btn-info").onclick=()=>I(),s())}}).start()})()})();